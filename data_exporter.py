import psycopg2
import json

conn = psycopg2.connect(
    database="jira_dataset", user='postgres', password='postgres', host='localhost', port='6060'
)
conn.autocommit = True


def get_jira_issue_reports():
    cursor = conn.cursor()
    cursor.execute(
        '''select * from jira_issue_report where id in (223700, 223703, 223704, 223707, 223732, 223709, 223715, 224125, 225402, 223730, 223735, 223737, 223738, 223740, 223743, 223744, 223749, 223750, 223753, 223767, 224295, 223768, 223810, 223754, 223755, 223756, 223761, 223762, 223769, 223770, 223774, 223775, 223780, 223781, 223787, 223789, 223793, 223797, 223801, 223804, 223805, 223808, 223815, 223912, 223821, 223823, 223828, 223829, 224365, 223831, 223834, 223835, 223836, 223839, 223840, 223881, 223843, 223844, 223847, 223852, 223854, 223859, 223860, 223861, 223862, 223863, 223870, 223878, 223887, 223888, 224218, 223893, 223895, 223898, 223923, 223905, 223906, 224219, 224502, 223914, 223921, 223947, 223925, 224101, 223926, 223929, 223932, 223933, 223936, 223942, 223943, 223944, 223948, 224084, 223950, 223954, 223955, 223958, 223963, 223964, 223967, 223968, 223969, 223972, 223974, 223983, 223984, 223985, 223989, 223992, 223994, 224000, 224001, 224042, 224085, 224006, 224014, 224020, 224021, 224024, 224070, 224028, 224029, 224030, 224031, 224034, 224037, 224038, 224039, 224044, 224045, 224047, 224050, 224052, 224057, 224059, 224060, 224061, 224063, 224065, 224066, 224067, 224069, 224075, 224076, 224077, 224078, 224079, 224081, 224087, 224092, 224094, 224095, 224099, 224292, 224103, 224107, 224110, 224111, 224114, 224127, 224120, 224121, 224129, 224131, 224133, 224136, 224169, 224170, 224504, 224138, 224140, 224143, 224144, 224147, 224149, 224150, 224154, 224156, 224158, 224159, 224161, 224164, 224173, 224174, 224176, 224177, 224180, 224181, 224182, 224194, 224195, 224196, 224197, 224207, 224208, 224210, 224211, 224212, 224213, 224214, 224216, 225317, 224222, 224225, 224229, 224230, 224233, 224234, 224264, 224236, 224241, 224244, 224246, 224248, 224250, 224258, 224259, 224260, 224261, 224262, 224265, 224267, 224268, 224270, 224272, 228021, 224296, 224279, 224281, 224283, 224285, 224287, 224289, 224290, 224297, 224298, 224299, 224305, 224326, 224307, 224310, 224316, 224317, 224323, 224325, 228941, 224327, 224330, 224331, 224338, 224340, 224343, 224345, 224346, 224347, 224350, 224353, 224354, 224358, 224363, 224364, 224368, 224370, 224375, 224376, 224378, 224379, 224388, 224389, 224391, 224394, 224404, 224414, 224417, 224418, 224422, 224426, 224430, 224432, 224434, 224436, 224437, 224447, 224450, 224453, 224454, 224455, 224459, 228942, 224485, 224463, 224464, 224469, 224470, 224471, 224477, 224480, 224481, 224482)''')
    result = cursor.fetchall()
    return list(map(lambda e: {'id': e[0], 'name': e[11], 'description': e[2], 'type': e[12]}, result))


def get_jira_issue_comments(report_id):
    cursor = conn.cursor()
    cursor.execute('''select * from jira_issue_comment where issue_report_id = '%s' order by creationdate asc''' % (
        str(report_id)))
    return list(map(lambda e: e[1], cursor.fetchall()))


result = []

reports = get_jira_issue_reports()
for report in reports:
    comments = get_jira_issue_comments(report['id'])
    report['comments'] = comments
    result.append(report)

with open('full_tickets.json', 'w') as f:
    f.write(json.dumps(result))
